Short Documentation for SparkBench
---------------------------------
Spark Benchmark Suite

Configuration:
--------------
    To configure the enviroment for the Spark-Bench suite make
    addition changes to the following file:
        bin/env.sh

    To support new configuration parameters for the spark just add new
    functions in the following file:
        bin/funcs.sh

Execute Benchmarks:
-------------------
    Generate datasets
    -----------------
    ./<Benchmark>/bin/gendata.sh

    Run Benchmarks
    --------------
    ./<Benchmark>/bin/run.sh

Executors Profiling :
---------------------
    SETUP
        1. Download and install InfluxDB
        (https://influxdata.com/downloads/#influxdb)

        Run it:
            # linux
            sudo service influxdb start

            Access the DB using either the web UI
            (http://localhost:8083/) or shell:

            # linux
            /user/bin/influx

        2. Create a database to store the stack traces in:

            CREATE DATABASE profiler

            Create a user:

            CREATE USER profiler WITH PASSWORD ‘profiler’ WITH ALL PRIVILEGES

        3. Build/download statsd-jvm-profiler jar
            https://github.com/etsy/statsd-jvm-profiler

            Deploy the jar to the machines which are running the
            executor processes. One way to do this is to using
            spark-submit’s –jars attribute, which will deploy it to
            the executor.

            --jars /path/to/statsd-jvm-profiler-2.1.0-jar-with-dependencies.jar

            Specify the Java agent in your executor processes. This
            can be done, for example, by using spark-submit’s –conf
            attribute

            -javaagent:statsd-jvm-profiler-2.1.0-jar-with-dependencies.jar=server=<INFLUX_DB_HOST>,port=<INFLUX_DB_PORT>,reporter=InfluxDBReporter,database=<INFLUX_DB_DATABASE_NAME>,username=<INFLUX_DB_USERNAME>,password=<INFLUX_DB_PASSWORD>,prefix=<TAG_VALUE_1>.<TAG_VALUE_2>.….<TAG_VALUE_N>,tagMapping=<TAG_NAME_1>.<TAG_NAME_2>.….<TAG_NAME_N>

        4. Download influxdb_dump.py
            https://github.com/aviemzur/statsd-jvm-profiler/blob/master/visualization/influxdb_dump.py

            Install all required python modules that influxdb_dump.py imports.

            Run influxdb_dump.py to create text files with stack
            traces as input for flame graphs:

            python influxdb_dump.py -o "<INFLUX_DB_HOST>" -u
            <INFLUX_DB_USERNAME> -p <INFLUX_DB_PASSWORD> -d
            <INFLUX_DB_DATABASE_NAME> -t <TAGS> -e <VALUES> -x "<OUTPUT_DIR>"

        5. Download flamegraph.pl
            https://github.com/brendangregg/FlameGraph/blob/master/flamegraph.pl

            Generate flame graphs using the text files you dumped from
            DB:

            flamegraph.pl <INPUT_FILES> > <OUTPUT_FILES>
